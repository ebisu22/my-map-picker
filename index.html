<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>åº§æ¨™ãƒ¡ãƒ¢ï¼†ãƒ¡ãƒ¼ãƒ«</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <style>
        body { margin: 0; padding: 0; width: 100%; height: 100dvh; display: flex; flex-direction: column; font-family: sans-serif; background: #f4f4f4; }
        
        /* åœ°å›³ã‚¨ãƒªã‚¢ */
        #map { flex-grow: 1; width: 100%; position: relative; min-height: 40%; }
        
        /* åå­—ã‚«ãƒ¼ã‚½ãƒ« */
        .crosshair {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 20px; height: 20px; pointer-events: none; z-index: 1000;
        }
        .crosshair::before, .crosshair::after { content: ''; position: absolute; background: #e74c3c; }
        .crosshair::before { top: 9px; left: 0; width: 20px; height: 2px; }
        .crosshair::after { top: 0; left: 9px; width: 2px; height: 20px; }

        /* æ“ä½œãƒ‘ãƒãƒ« */
        .panel {
            padding: 15px; background: #fff;
            padding-bottom: calc(15px + env(safe-area-inset-bottom));
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            display: flex; flex-direction: column; gap: 10px;
            max-height: 50%; overflow-y: auto;
        }

        /* å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ  */
        .input-group { display: flex; flex-direction: column; gap: 8px; border-bottom: 1px solid #eee; padding-bottom: 10px;}
        input, textarea {
            padding: 10px; font-size: 16px; border: 1px solid #ddd; border-radius: 5px; width: 100%; box-sizing: border-box;
        }
        textarea { height: 60px; resize: none; }

        /* ãƒœã‚¿ãƒ³é¡ */
        .btn-row { display: flex; gap: 10px; }
        button {
            padding: 12px; font-size: 16px; border: none; border-radius: 5px; color: white; font-weight: bold; cursor: pointer; flex: 1;
        }
        .btn-add { background-color: #28a745; }
        .btn-gps { background-color: #6c757d; flex: 0 0 50px; }
        .btn-mail { background-color: #007bff; margin-top: 10px; }
        .btn-clear { background-color: #dc3545; margin-top: 5px; font-size: 12px; padding: 8px; }

        /* ãƒªã‚¹ãƒˆè¡¨ç¤º */
        #list-area { font-size: 14px; color: #333; }
        .list-item { background: #f9f9f9; padding: 8px; margin-bottom: 5px; border-left: 4px solid #28a745; }
        .list-coords { font-size: 11px; color: #666; font-family: monospace; }
    </style>
</head>
<body>

<div id="map">
    <div class="crosshair"></div>
</div>

<div class="panel">
    <div class="input-group">
        <div class="btn-row">
            <input type="text" id="inp-title" placeholder="ã‚¿ã‚¤ãƒˆãƒ« (ä¾‹: å…¬åœ’ã®å…¥ã‚Šå£)">
            <button class="btn-gps" onclick="getLocation()">ğŸ“</button>
        </div>
        <textarea id="inp-detail" placeholder="è©³ç´°ãƒ¡ãƒ¢"></textarea>
        <button class="btn-add" onclick="addToList()">â¬‡ï¸ ãƒªã‚¹ãƒˆã«è¿½åŠ </button>
    </div>

    <div id="list-area">
        <div style="color:#aaa; text-align:center; padding:10px;">(ã¾ã è¨˜éŒ²ã¯ã‚ã‚Šã¾ã›ã‚“)</div>
    </div>

    <button class="btn-mail" onclick="sendMail()">ğŸ“§ ã¾ã¨ã‚ã¦ãƒ¡ãƒ¼ãƒ«é€ä¿¡</button>
    <button class="btn-clear" onclick="clearList()">ğŸ—‘ï¸ ãƒªã‚¹ãƒˆã‚’å…¨æ¶ˆå»</button>
</div>

<script>
    var map = L.map('map').setView([35.681236, 139.767125], 15);
    L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 19, attribution: 'Â© OpenStreetMap' }).addTo(map);
    var currentLocMarker = null;

    var savedPoints = [];

    // â˜…å®›å…ˆã‚¢ãƒ‰ãƒ¬ã‚¹ã®è¨­å®š
    var mailToAddress = "ebisu22@gmail.com";

    function addToList() {
        var title = document.getElementById('inp-title').value;
        var detail = document.getElementById('inp-detail').value;
        var center = map.getCenter();
        var lat = center.lat.toFixed(6);
        var lng = center.lng.toFixed(6);

        if(!title) { alert("ã‚¿ã‚¤ãƒˆãƒ«ã‚’å…¥ã‚Œã¦ãã ã•ã„"); return; }

        savedPoints.push({ title: title, detail: detail, lat: lat, lng: lng });
        renderList();
        
        document.getElementById('inp-title').value = "";
        document.getElementById('inp-detail').value = "";
        alert("ãƒªã‚¹ãƒˆã«è¿½åŠ ã—ã¾ã—ãŸ (" + savedPoints.length + "ä»¶ç›®)");
    }

    function renderList() {
        var listArea = document.getElementById('list-area');
        if (savedPoints.length === 0) {
            listArea.innerHTML = '<div style="color:#aaa; text-align:center; padding:10px;">(ã¾ã è¨˜éŒ²ã¯ã‚ã‚Šã¾ã›ã‚“)</div>';
            return;
        }

        var html = "";
        savedPoints.forEach(function(item, index) {
            html += `
                <div class="list-item">
                    <strong>${index + 1}. ${item.title}</strong><br>
                    ${item.detail}<br>
                    <span class="list-coords">${item.lat}, ${item.lng}</span>
                </div>`;
        });
        listArea.innerHTML = html;
    }

    function sendMail() {
        if (savedPoints.length === 0) { alert("é€ã‚‹ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“"); return; }

        var subject = "ã€æ•£æ­©è¨˜éŒ²ã€‘" + new Date().toLocaleDateString();
        var body = "è¨˜éŒ²ã—ãŸå ´æ‰€ãƒªã‚¹ãƒˆ:\n\n";

        savedPoints.forEach(function(item, index) {
            body += `â–  ${index + 1}. ${item.title}\n`;
            if(item.detail) body += `è©³ç´°: ${item.detail}\n`;
            body += `åº§æ¨™: ${item.lat}, ${item.lng}\n`;
            body += `åœ°å›³: http://maps.google.com/maps?q=${item.lat},${item.lng}\n\n`;
            body += `------------------\n`;
        });

        // ã“ã“ã§å®›å…ˆã‚’æŒ‡å®šã—ã¦ã„ã¾ã™
        window.location.href = `mailto:${mailToAddress}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
    }

    function clearList() {
        if(confirm("ãƒªã‚¹ãƒˆã‚’å…¨ã¦æ¶ˆã—ã¾ã™ã‹ï¼Ÿ")) {
            savedPoints = [];
            renderList();
        }
    }

    function getLocation() {
        if (!navigator.geolocation) return alert("GPSéå¯¾å¿œ");
        navigator.geolocation.getCurrentPosition(function(pos) {
            var lat = pos.coords.latitude;
            var lng = pos.coords.longitude;
            map.setView([lat, lng], 18);
            if (currentLocMarker) map.removeLayer(currentLocMarker);
            currentLocMarker = L.circleMarker([lat, lng], { color: 'white', fillColor: '#007bff', fillOpacity: 0.8, radius: 8 }).addTo(map);
        });
    }
</script>

</body>
</html>
